#  HTTPS HTTP1.1 / HTTP2 / HTTP3

HTTPS (安全的 HTTP 通道)
HTTP over secureSocket Layer

HTTPS 引入了 SSL/TLS 安全协议来解决安全问题,使报文能够加密传输

SSL/TLS 加在 OSI 七层模型中的 会话层

**TLS 设计的目的**

为了解决 HTTP 明文传输不安全的特性
保密性:

混合加密的⽅式实现信息的机密性，解决了窃听的⻛险。

完整性:

摘要算法的⽅式来实现完整性，它能够为数据⽣成独⼀⽆⼆的「指纹」，指纹⽤于校验数据的完整性，解决 篡改的⻛险。

身份验证:

将服务器公钥放⼊到数字证书中，解决了冒充的⻛险

## HTTPS 和 HTTP的区别
- 安全性
HTTPS 在会话层添加了 SSL/TLS 安全协议,使得报文能够加密传输

- 端口: HTTP 的端口号是 80 HTTPS的端口号是 443

- 证书: HTTPS 协议需要向 CA 证书机构 申请数字证书需要收费,来保证服务器的身份是可信的.

- 连接过程: HTTP 基于 TCP 三次握手后即可进行 HTTP 的报文传输.
而HTTPS 在 进行 TCP 三次握手后还要进行 SSL/TLS 的四次握手才可以进行加密报文传输.

## HTTPS 的工作过程
1. Client 发起请求 (端口443)
2. Server 返回`公钥`证书 (Server 有公钥和私钥)
3. Client 验证证书
4. Client 生成对称密钥,使用公钥加密后发给 Server
5. Server 使用私钥解密,得到对称密钥
6. Client / Server 使用对称密钥 (对称加密): 加密明文并发送,解密密文得到明文


### 对称加密

![image-20230301213237841](https://cyzblog-1305365553.cos.ap-guangzhou.myqcloud.com/image-20230301213237841.png)

对称加密的特点是使用同一份密钥,进行加密和解密.实际上核心算法就是 异或算法

比如 原始文档的内容 为 `0111` 密钥为 `0011` 异或之后就是 `0100`  在解密再次异或 `0111`

### 非对称加密

![image-20230301213806730](https://cyzblog-1305365553.cos.ap-guangzhou.myqcloud.com/image-20230301213806730.png)

非对称加密需要使用 一对密钥 公钥和私钥. 一般由服务器发送公钥给客户端,客户端使用公钥加密后, 将密文发给 server 端,server 端在使用与之相对的私钥来解密.



HTTPS 采用的是混合加密, 在连接建立前使用的是 非对称加密, 连接建立成功后使用 对称加密.

### 数字证书

如何保证服务器发来的公钥不会篡改和信任度.

将服务器的公钥放在 CA 数字证书权威机构里,证书是可信的,公钥就是可信的.

![image-20230301214652419](https://cyzblog-1305365553.cos.ap-guangzhou.myqcloud.com/image-20230301214652419.png)

### 摘要算法

使用摘要算法来实现 数据的完整性,能够为数据生成独一无二的 指纹,解决了篡改的风险

![image-20230301214910950](https://cyzblog-1305365553.cos.ap-guangzhou.myqcloud.com/image-20230301214910950.png)



## SSL/TLS 四次握手过程
1. ClientHello

第一步,由客户端向服务器发起加密通信请求
客户端主要向服务器发送以下信息
(1) 客户端支持的 `SSL/TLS` 协议版本,如 `TLS1.2` 版本
(2) 客户端生成的随机数,后面用于生成会话密钥
(3) 客户端支持的密码套件列表,如 RSA 加密算法.


2. ServerHello

服务器收到客户端请求后,向客户端发出响应,服务器回应的内容如下
(1) 确认 `SSL/TLS` 协议版本,如果浏览器不支持,则关闭加密通信
(2) 服务器生成的随机数,后面用于生成会话密钥
(3) 确认的密码套件列表,如 RSA 加密算法
(4) 服务器的数字证书

3. 客户端回应
客户端收到服务器的回应后,首先通过浏览器或者操作系统中的 CA 公钥,确认服务器的数字证书的真实性.
如果证书没有问题,会从数字证书中取出服务器的公钥,然后使用它加密报文,向服务器发送如下信息:
(1) 一个随机数.该随机数会被服务器公钥加密.
(2) 加密通信算法改变通知,表示随后的信息都将用 会话密钥加密通信.
(3) 客户端握手结束通知,表示客户端的握手阶段以结束.

使用三个随机数,使用双方协商的算法 各自生成 会话密钥

4. 服务器最后的响应
服务器收到客户端 的第三个随机数之后,通过协商的加密算法,计算出本次通信的会话密钥,然后向客户端发送最后的信息
(1) 加密通信算法改变通知,表示随后的信息都将用 会话密钥加密通信.
(2) 服务器握手结束通知,表示服务器的握手阶段已结束.