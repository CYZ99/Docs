# 存储类别,链接

先理解几个关键的概念:

作用域 链接 存储期
## 1.作用域
🔑作用域描述程序中可访问标识符的区域.

作用域分类: 一个C程序变量的作用域可以是, **块级作用域**, **函数作用域**, **函数原型作用域**, **文件作用域**.

🫡块级作用域:

是指一对花括号括起来的 代码作用域. 块级作用域的变量的可见范围,是从定义处到包含该定义的块的结尾.
函数的形参属于该函数的块级作用域.

🏷️函数作用域:

仅用于 goto 语句的标签

✨函数原型作用域:

用于函数原型中的形参名, 函数的范围是从形参定义到原型声明结束.

🎈文件作用域:

变量定义在函数外面, 具有文件作用域, 具有文件作用域的变量从定义处到整个文件的末尾均可见.(全局变量)

:::tip
注意
翻译单元和文件

翻译单元是指: 一个C文件 包括了各种各样的头文件,这些文件会被预处理器展开, 所以编译器会将
这个文件的源代码和所有头文件都看成是一个包含信息的单独文件,这个文件被称为翻译单元.一个具有文件作用域的变量,它的实际可见范围是整个翻译单元.

如果程序包含了多个源代码文件那么该程序也将由多个翻译单元组成.
:::

## 2. 链接

C 语言变量有三种链接属性, 外部链接, 内部链接或无链接.


具有**块级作用域,原型作用域,函数作用域**的变量是无链接的变量.(私有变量)

具有**文件作用域的变量**可以是 外部链接或内部链接, 外部链接可以在多个源文件中使用, 内部链接只能在一个翻译单元使用.

如何判断全局变量是外部链接还是内部链接的变量❓

使用 static 修饰的全局变量是 内部链接的.
反之是外部链接的全局变量.

## 3. 存储期

作用域和链接描述了变量的可见范围, 而存储期描述了变量的生存期.

C 语言有四种存储期: **静态存储期, 线程存储期, 自动存储期, 动态分配存储期**

- 对于静态存储期的变量,在整个程序的运行期间都存在. 具有文件作用域的变量具备静态存储期

-  线程存储期被用于并发程序设计中,变量从声明到线程结束前在存在.

-  块级作用域的变量一般都是自动存储期, 在块中声明变量时系统分配内存存放此变量, 当退出这个块时,程序会释放存放这些变量的内存.

-  对于动态分配存储期的变量在另一篇文章中叙述.

:::tip
注意: 1. 对于文件作用域的变量 使用 static 修饰只是影响了其链接属性.不影响其存储期

注意: 2. 块级作用域的变量也能具有静态存储期, 在声明变量时在 前面添加关键字 static 使这个变量具备静态存储期.
:::

## 存储类别

五种存储类别
| 存储类别     | 存储期 | 作用域 | 链接 | 声明方式                      |
| ------------ | ------ | ------ | ---- | ----------------------------- |
| 自动         | 自动   | 块     | 无   | 块内                          |
| 寄存器       | 自动   | 块     | 无   | 块内使用 register 关键字      |
| 静态外部链接 | 静态   | 文件   | 外部 | 函数外                        |
| 静态内部链接 | 静态   | 文件   | 内部 | 函数外 使用 static 关键字约束 |
| 静态无链接   | 静态   | 块     | w无  | 块内 使用 static 关键字约束   |

### 自动存储类别几个关键点

可以使用 auto 关键字 (也属于存储类别说明符) 来显示指定变量的存储类别. 

在块级作用域中声明.

如果 外层块声明的变量和内层块声明的变量同名, 内层块会隐藏外层块的定义.

变量具有自动存储周期, 进入变量声明的块时,变量存在,退出块时变量消失.原来占用的内存现在可做他用.

**自动变量的初始化**

自动变量不会初始化,除非你显示初始化它.



### 寄存器变量

声明寄存器变量使用 register 关键字声明, 但这只是一种请求,编译器会根据寄存器最快可用的内存的数量衡量请求.或者直接忽略你的请求,将寄存器变量变为自动存储类别的变量.



### 块级作用域的静态变量

静态的意思是,变量放在内存中原地不动,值会发生变化. 全局变量自动具备这种属性,具有静态存储期.

块级作用域限制此变量的访问范围, 静态变量使得此变量拥有静态存储期.

**未初始化的静态变量会被默认初始化为 0.**

**不能在函数形参中使用static声明变量**



### 外部链接的静态变量



1. 外部链接的静态变量具有文件作用域, 静态存储期,外部链接.

2. 可以使用 extern 关键字再次声明.

3. 如果一个源代码文件中使用的外部变量定义在另一个源代码文件中.则必须使用 extern 在该文件中声明该变量.

4. 初始化外部变量只能使用常量.未初始化的变量会被默认初始化为 0.



定义式声明和引用式声明:

```c
int tern = 1; // tern 被定义
int main()
{
    extern int tern; // 引用式声明
    return 0;
}
```

extern 关键字表示该声明不是定义,让编译器去其他地方寻找其定义.该声明不会引起内存分配.

因此不要使用 extern 创建外部变量, 只用它来引用现有的外部定义.

:::tip

注意外部变量只能初始化一次,且必须在定义变量时进行.

:::



### 内部链接的静态变量

这种变量具备 文件作用域, 内部链接, 静态存储期

内部静态链接的变量只能在 同一个翻译单元中使用.



## 多文件规范

一个复杂的C程序需要多个翻译单元组成,这些文件需要共享一个变量,C 通过在一个文件中定义该变量其他文件使用引用式声明 extern 声明该变量才可以使用. 而且只有定义式声明变量才可以初始化.



































